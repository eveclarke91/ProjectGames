<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <meta name="msapplication-tap-highlight" content="no" />
        <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
        <script src="js/jquery-1.11.2.min.js"></script>
        <script src="js/jquery-ui.min.js"></script>

        <script type="text/javascript">

        //Globals
            var studentNo = 0;
            var gametype = "spelling";
            var difficulty = "easy";            
            var score = 0;

        //Maths Variables
            var wrong = 0;
            var questionNo = 1;
            var maxQuestionNo = 10;
            var answer;

        //Memory Variables
            var maxCards = 12;
            var animalCards=[
                "img/animals/elephant.png",
                "img/animals/lion.png",
                "img/animals/pig.png",
                "img/animals/zebra.png",
                "img/animals/penguin.png",
                "img/animals/seal.png",
                "img/animals/monkey.png",
                "img/animals/donkey.png",
                "img/animals/cat.png",
                "img/animals/chicken.png"
            ];
            var associativeCards=[
                ["img/associate/ball.PNG","img/associate/racket.PNG"],
                ["img/associate/basketball.PNG","img/associate/hoop.PNG"],
                ["img/associate/bee.PNG","img/associate/honey.PNG"],
                ["img/associate/bucket.PNG","img/associate/spade.PNG"],
                ["img/associate/cake.PNG","img/associate/present.PNG"],
                ["img/associate/can.PNG","img/associate/flower.PNG"],
                ["img/associate/collar.PNG","img/associate/dog.PNG"],
                ["img/associate/cow.PNG","img/associate/milk.PNG"],
                ["img/associate/egg.PNG","img/associate/hen.PNG"],
                ["img/associate/shoe.PNG","img/associate/sock.PNG"]
            ];

        //Spelling Variables
            var easywords = [
                ["lion",
                "img/spelling/lion.png",
                "sound/spelling/lion.mp3"
                ],
                ["pig",
                "img/spelling/pig.png",
                "sound/spelling/pig.mp3"
                ],
                ["seal",
                "img/animals/seal.png",
                "sound/spelling/seal.mp3"
                ],
                ["cat",
                "img/animals/cat.png",
                "sound/spelling/cat.mp3"
                ]                
            ];

            var mediumwords = [ 
                ["donkey",
                "img/animals/donkey.png",
                "sound/spelling/donkey.mp3"
                ],
                ["chicken",
                "img/animals/chicken.png",
                "sound/spelling/chicken.mp3"
                ],                
                ["monkey",
                "img/animals/monkey.png",
                "sound/spelling/monkey.mp3"
                ],
                ["zebra",
                "img/animals/zebra.png",
                "sound/spelling/zebra.mp3"
                ]               
            ];

            var hardwords = [
                ["elephant",
                "img/spelling/elephant.png",
                "sound/spelling/elephant.mp3"
                ],
                ["donkey",
                "img/animals/donkey.png",
                "sound/spelling/donkey.mp3"
                ],
                ["chicken",
                "img/animals/chicken.png",
                "sound/spelling/chicken.mp3"
                ],
                ["penguin",
                "img/animals/penguin.png",
                "sound/spelling/penguin.mp3"
                ],
                ["monkey",
                "img/animals/monkey.png",
                "sound/spelling/monkey.mp3"
                ]              
            ];

            var randomnumber, dragletters, dropboxes, maxcorrectlettercount, correctlettercount, words;
            var game_no = 0;
            var max_game_no = 3;

        //Core Functions
            function getRandomNumber(minValue, maxValue){
                var max = maxValue;
                var min = minValue;
                var randomnumber = Math.floor(Math.random() * (max - min + 1)) + min;
                return randomnumber;
            }
            function endGameScore(){
                removeContainerContent();
                $('.container').html("<h1>Your Score</h1><h1>"+score+"</h1>");
                if(hasInternetConnection() && studentNo > 0){
                    $.ajax({
                        type: 'POST',
                        data: { student_code: studentNo, game_type: gametype , game_difficulty: difficulty, game_score: score },
                        url: 'http://localhost/project/submitScore.php',
                        success: function(data){ 
                            if(data > 0){
                                console.log("submitted score to server");
                            }                       
                        }
                    });
                }  
                

                $('.container').append(function() {
                  return $("<div class='continue'>CONTINUE</div>").click(function(){
                    gameMenu();
                    score = 0;
                  });
                });
            }
            function removeContainerContent(){
                $('.container').empty();
            }
            function startPage(){
                removeContainerContent();
                $('.container').html("<h1>You've been schooled!</h1><div id= 'start'>Play</div>");
                $('#start').click(function(){
                    if(hasInternetConnection()){                        
                        studentPage();
                    }else{
                        gameMenu();
                    }                    
                }); 
            }
            function gameMenu(){
                removeContainerContent();
                $('.container').html('<div class = "gameButton" id = "memoryButton">Memory</div><div class = "gameButton" id= "mathsButton">Maths</div><div class = "gameButton" id = "spellingButton">Spelling</div>');
                resetGames();

                $('#memoryButton').click(function(){
                    gametype = 'memory';
                    difficultyMenu();
                });

                $('#mathsButton').click(function(){
                    gametype = 'maths';
                    difficultyMenu();
                });

                $('#spellingButton').click(function(){
                    gametype = 'spelling';
                    difficultyMenu();
                });
            }
            function difficultyMenu(){
                removeContainerContent();
                $('.container').html('<div class = "difficultyButton" id = "easyButton">Easy</div><div class = "difficultyButton" id = "mediumButton">Medium</div><div class = "difficultyButton" id = "hardButton">Hard</div>');

                $('#easyButton').click(function(){
                    difficulty = 'easy';
                    startGame();
                });

                $('#mediumButton').click(function(){
                    difficulty = 'medium';
                    startGame();
                });

                $('#hardButton').click(function(){
                    difficulty = 'hard';
                    startGame();
                });
            }
            function startGame(){
                //alert(gametype+" "+difficulty);
                if(gametype == "memory"){
                    newMemoryGame(difficulty);
                }else if(gametype == "maths"){
                    newMathsGame(difficulty);
                }else if(gametype == "spelling"){
                    newSpellingGame(difficulty);
                }
            }
            function studentPage(){
                removeContainerContent();
                $('.container').html('<h1>Enter Your Student Number</h1><form><input type="text" name="number" id="studentNo"></input></form><div id="wrapper"><div id="save">Save</div><div id="skip">Skip</div></div>');
                $('#save').click(function(){
                    var student = $('#studentNo').val();
                    $.ajax({
                        type: 'POST',
                        data: 'data='+String(student),
                        url: 'http://localhost/project/studentCheck.php',
                        success: function(data){ 
                            if(data>0){
                                studentNo = data;
                                gameMenu();
                            }else{
                                studentPage();
                                alert("Invalid Number");
                            }
                        }
                    });
                });
                $('#skip').click(function(){
                    gameMenu();
                });
            }
            function resetGames(){
                game_no = 0;
                wrong = 0;
                questionNo = 1;
                score = 0;
            }
            function hasInternetConnection(){
                return true;
            }
        //Maths Functions
            function addMathsGameContent(){
                removeContainerContent();
                $('.container').html("<div>Question <span id='questionNo'></span> of <span id='maxQuestionNo'></span></div><div>Score = <span id='score'>0</span></div><div>Wrong = <span id='wrong'>0</span></div><div class = 'maths-container'><div class = 'mathsbox box1'> 1 </div><div class = 'mathsbox box2'> + </div><div class = 'mathsbox box3'> 2 </div><div class = 'mathsbox box4'> = </div><div class = 'mathsbox box5'> 3 </div><div class = 'clear'></div></div><div class='answers-container'><div class = 'answerbox answer1'></div><div class = 'answerbox answer2'></div><div class = 'answerbox answer3'></div><div class = 'answerbox answer4'></div><div class = 'clear'></div></div><div id='myProgress'><div id='myBar'></div></div>");
            }
            function newMathsGame(dif){
                addMathsGameContent();
                if(questionNo>maxQuestionNo){
                    endGameScore();
                }
                difficulty = dif;
                resetAnswers();
                var questionPercent = 100/maxQuestionNo;
                var progress = questionPercent * questionNo;

                $('#myBar').css( 'width', progress+'%' );


                $('#questionNo').html(questionNo);
                $('#maxQuestionNo').html(maxQuestionNo);
                $('#score').html(score);
                $('#wrong').html(wrong);

               // var maxValue = 12;
                var operator = 1;
                var operatorString;
                var maxAddition = 12;
                var maxSubtraction = 12;
                var maxDivision = 12;
                var maxMultiplication =12;

                if(difficulty == 'medium'){
                    //maxValue = 8;
                    maxAddition = 50;
                    maxSubtraction = 12;
                    operator = 2;
                }else if(difficulty == 'hard'){
                    //maxValue = 12;
                    maxAddition = 100;
                    maxSubtraction = 100;
                    maxDivision = 50;
                    maxMultiplication = 12;
                    operator = 4;
                }

                var element1;
                var element2 = getRandomNumber(1, operator);
                var element3;

                if(element2 == 1){

                    element1 = getRandomNumber(1, maxAddition);
                    element3 = getRandomNumber(1, maxAddition);

                    answer = element1 + element3;
                    operatorString = '+';
                }else if(element2 == 2){
                    element1 = getRandomNumber(1, maxSubtraction);
                    element3 = getRandomNumber(1, maxSubtraction);

                    if(element3 > element1){
                        var temp = element1;
                        element1 = element3;
                        element3 = temp;
                    }
                    answer = element1 - element3;
                    operatorString = '-';
                }else if(element2 == 3){
                    element1 = getRandomNumber(1, maxMultiplication);
                    element3 = getRandomNumber(1, maxMultiplication);

                    answer = element1 * element3;
                    operatorString = 'X';
                }else if(element2 == 4){
                    element1 = getRandomNumber(1, maxDivision);
                    element3 = getRandomDivisor(element1);

                    answer = element1 / element3;
                    operatorString = '%';

                }

                 $('.box1').html(element1);
                 $('.box2').html(operatorString);
                 $('.box3').html(element3);
                 $('.box4').html('=');
                 $('.box5').html(answer);

                 var wrongAnswer1 = answer -1;
                 var wrongAnswer2 = answer -2;
                 var wrongAnswer3 = answer +3;

                 var answerArray = new Array();
                 answerArray.push(answer);
                 answerArray.push(wrongAnswer1);
                 answerArray.push(wrongAnswer2);
                 answerArray.push(wrongAnswer3);


                 for (var i = answerArray.length; i > 0;) {
                    var random = parseInt(Math.random() * i);
                    var temp = answerArray[--i];
                    answerArray[i] = answerArray[random];
                    answerArray[random] = temp;
                }

                $('.answer1').attr("answer",answerArray[0]).html(answerArray[0]);
                $('.answer2').attr("answer",answerArray[1]).html(answerArray[1]);
                $('.answer3').attr("answer",answerArray[2]).html(answerArray[2]);
                $('.answer4').attr("answer",answerArray[3]).html(answerArray[3]); 

                $('.answerbox').off('click');
                $(".answerbox").click(function(){
                    if(answer == $(this).attr("answer")){
                        correctAnswers(answer);
                        setTimeout(function(){
                            score = score + 1;
                            questionNo = questionNo +1;
                            newMathsGame(difficulty);
                        }, 2000);
                    }else{
                        correctAnswers(answer);
                        setTimeout(function(){
                            wrong = wrong + 1;
                            questionNo = questionNo +1;
                            newMathsGame(difficulty);
                        }, 2000);
                    }
                });      
            }
            function getRandomDivisor(num){
               var divisors = [];
                for (i = 1; i <= num; i++) {
                    if (num % i == 0) {
                        divisors.push(i);
                    }
                }
                
                var randomDivisor;
                if(divisors.length > 2){
                    randomDivisor = getRandomNumber(2, divisors.length-1);
                }else{
                    randomDivisor = getRandomNumber(1, divisors.length);
                }
                return divisors[randomDivisor-1];
            }
            function correctAnswers(answer){
                $('.answerbox').each(function () {
                    if($(this).attr("answer") == answer){
                        this.style.setProperty( 'background-color', '#53FF24', 'important' );
                    }else{
                        this.style.setProperty( 'background-color', '#FF2427', 'important' );
                    }
                });
            }
            function resetAnswers(){
                $('.answerbox').each(function () {
                    this.style.setProperty( 'background-color', '#eee', 'important' );
                });
            }
            
        //Memory Functions
            function addMemoryGameContent(){
                removeContainerContent();
                $('.container').html('<div>Turns = <span id="score">0</span></div><div class="card-container"></div>');
            }
            function newMemoryGame(dif){
                addMemoryGameContent();

                if(dif == "easy"){
                    maxCards = 12;
                }else if(dif == "medium"){
                    maxCards = 20;
                }else if(dif == "hard"){
                    maxCards = 20;
                }

                var noOfPairs = maxCards/2;
                var randomCards = randomCardsArray(maxCards);
                var i=0;
                var correctPairs = 0;
                var pair1, pair2;

                //print 
                for(var j = 0; j<randomCards.length; j++){
                    $('.card-container').append('<div class="card card-back" pair="'+ randomCards[j][0] +'" no="'+ randomCards[j][1] +'"></div>');
                } 

                $(".card").click(function(){                    

                    var pairNo = $(this).attr("pair");
                    var associateNo = $(this).attr("no");
                    $(this).removeClass("card-back").addClass("card-front");

                    if(dif == "hard"){
                        $(this).html('<img src="'+associativeCards[pairNo][associateNo]+'"></img>');
                    }else{
                        $(this).html('<img src="'+animalCards[pairNo]+'"></img>');
                    }
                    

                    if(i == 0){
                        pair1 = pairNo;
                        pair2 = 5000;
                    }else if(i == 1){
                        score = score+1;
                        $('#score').html(score);
                        pair2 = pairNo;
                        clickBlocker('on');
                        if(pair1 == pair2){                            
                            setTimeout(function(){
                                $("div[pair='"+pair1+"']").empty();
                                $("div[pair='"+pair1+"']").removeClass("card card-front").addClass("card-match");
                                correctPairs = correctPairs+1;                            
                                resetCards();
                                if(correctPairs>=Math.floor(maxCards/2)){
                                    removeContainerContent();
                                    endGameScore();
                                }
                                clickBlocker('off');                                
                                i=0;
                            }, 1000);
                        }else if(i>=1){ //No Pair Found
                            setTimeout(function(){
                                resetCards();
                                clickBlocker('off');
                                i=0;
                            }, 1000);                        
                        }
                    }                   
                    i++;
                }); 
            }
            function randomCardsArray(noOfCards){
                var cardsArray = new Array(noOfCards);
                var j = 0;
                for (var k = 0; k < cardsArray.length; k++) {
                    if(j == 2){
                        j = 0;
                    }
                    cardsArray[k] = new Array(2);
                    cardsArray[k] = [Math.floor(k/2),j];
                    j++;
                }
                for(var l = cardsArray.length; l > 0;) {
                    var random = parseInt(Math.random() * l);
                    var temp = cardsArray[--l];
                    cardsArray[l] = cardsArray[random];
                    cardsArray[random] = temp;
                }
                return cardsArray;
            }
            function clickBlocker(status){
                if(status == "on"){
                    $('body').prepend( '<div id="bg"></div>' );
                }else if(status == "off"){
                    $('#bg').remove();
                }
            }
            function resetCards(){
                $('.card').removeClass("card-front").addClass("card-back");
                $('.card').empty();
            }

        //Spelling Functions
            function addSpellingGameContent(){
                removeContainerContent();
                $('.container').html('<div>Game <span id="game_no"></span> of <span id="max_game_no"></span></div><div>Score = <span id="score">0</span></div><div><img id="game_image" src="img/spelling/elephant.png"></img></div><div class="drop-panel"></div><div class="drag-panel"></div>');
            }
            function randomizestring(string) {
                var possible = "abcdefghijklmnopqrstuvwxyz";
                for( var j=0; j < 4; j++ ){
                    string += possible.charAt(Math.floor(Math.random() * possible.length));
                }

                var parts = string.split('');
                for (var i = parts.length; i > 0;) {
                    var random = parseInt(Math.random() * i);
                    var temp = parts[--i];
                    parts[i] = parts[random];
                    parts[random] = temp;
                }
                return parts.join('');
            };
            function newSpellingGame(dif){
                addSpellingGameContent();

                $('#score').text(score);

                if(dif == "easy" && game_no == 0){
                    words = easywords.slice();
                    max_game_no = 2;
                }else if(dif == "medium" && game_no == 0){
                    words = mediumwords.slice();
                    max_game_no = 2;
                }else if(dif == "hard" && game_no == 0){
                    words = hardwords.slice();
                    max_game_no = 2;
                }

                var randomnumber = Math.floor(Math.random() * words.length);

                var game = words[randomnumber];
                words.splice(randomnumber,1); //removes from the array so you dont get it a second time.
                var dragletters = game[0];
                var dropboxes = game[0];
                var maxcorrectlettercount = game[0].length;  
                var correctlettercount = 0;
                var actualgameno = game_no + 1;
                var actualmaxgameno = max_game_no + 1;

                dragletters = randomizestring(dragletters);

                $('.drag-panel').html("");
                $('.drop-panel').html("");
                $('#game_no').html(actualgameno);
                $('#max_game_no').html(actualmaxgameno);

                $("#game_image").attr("src",game[1]); // set the game image

                for( var j=0; j<dragletters.length; j++){ // print all draggable boxes
                    $('.drag-panel').append('<div class="drag-box" id="'+dragletters[j]+'"><p>'+dragletters[j].toUpperCase()+'</p></div>');
                }

                $(".drag-box").draggable({ revert: "valid" }); // make all drag boxes draggable

                for( var k=0; k<dropboxes.length; k++){ // print all dropable boxes
                    $('<div class="drop-box" accept="'+dropboxes[k]+'"><p>empty</p></div>').droppable({
                        drop: function( event, ui ) {
                            if( $(ui.draggable).text() == $(this).attr("accept").toUpperCase() ){
                                $(this).addClass("correct").find("p").html($(ui.draggable).text());
                                $(ui.draggable).css("display","none");
                                correctlettercount = correctlettercount+1;
                                if(correctlettercount == maxcorrectlettercount){                                    
                                    if(game_no == max_game_no){
                                        endGameScore();
                                    }else{
                                        game_no = game_no + 1;
                                        newSpellingGame(dif);  
                                    }                                    
                                }
                            }else{
                                score = score+1;
                                $('#score').text(score); 
                            }                
                          }
                    }).appendTo( ".drop-panel" );
                }
            }

            $(document).ready(function() {

                startPage();
                //checkConnection();
                //endGameScore();

            });

        </script>
        <link rel="stylesheet" type="text/css" href="css/memory.css" />
        <title>Simple Memory Game</title>
    </head>

    <body>      
        
        
        <div class = "container center-text">

            


            


            
        </div>

        
        <script type="text/javascript" src="js/index.js"></script>
        <script type="text/javascript">
            app.initialize();
        </script>

    </body>



</html>


